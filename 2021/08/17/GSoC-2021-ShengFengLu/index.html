

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Quark-Engine">
  <meta name="keywords" content="Android">
  
  <title>GSoC-2021-ShengFengLu - Quark-Engine</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"quark-engine.github.io","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Quark-Engine</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="GSoC-2021-ShengFengLu">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-08-17 15:12" pubdate>
        August 17, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.8k words
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      56
       minutes
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">GSoC-2021-ShengFengLu</h1>
            
            <div class="markdown-body">
              <h1 id="Replace-the-core-library-of-Quark-Engine"><a href="#Replace-the-core-library-of-Quark-Engine" class="headerlink" title="Replace the core library of Quark-Engine"></a>Replace the core library of Quark-Engine</h1><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>My name is Sheng-Feng Lu. I am a fourth-year CS undergraduate student at <a target="_blank" rel="noopener" href="https://www.nsysu.edu.tw/">NSYSU</a>, Taiwan. This summer, I participated in a <a target="_blank" rel="noopener" href="https://summerofcode.withgoogle.com/">Google Summer of Code</a> project under the <a target="_blank" rel="noopener" href="https://www.honeynet.org/">Honeynet Project</a> and I contributed to <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine">Quark-Engine</a>, an Android malware storyteller. The two main goals of my project are <strong>1. To rewrite the core library of Quark with <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin">Rizin</a></strong> and <strong>2. Evaluate and improve the performance of Quark Engine</strong>.</p>
<p>The following section is the summary of <span style="color:#FF3377"><strong>9</strong></span> important works I’ve done and their impacts. Also, works like <a href="#3-Implement-an-abstract-class-for-Quark-core-libraries">#3</a>, <a href="#4-Implement-Quark%E2%80%99s-new-core-library-with-Rizin">#4</a>, <a href="#5-Implement-more-bytecode-instructions-in-Quark%E2%80%99s-Dalvik-bytecode-loader">#5</a>, <a href="#6-Add-feature-Inheritance-class-check">#6</a>, and <a href="#8-Quark-Performance-Improvement">#8</a> need to be highlighted since they reached huge milestones for Quark Engine.</p>
<h3 id="1-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine"><a href="#1-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine" class="headerlink" title="1. Add new test cases and improve the existing ones for Quark-Engine"></a><strong>1. Add new test cases and improve the existing ones for Quark-Engine</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> <strong>96</strong> test cases are added and <strong>19</strong> test cases are improved.<br>– <span style="color:#FF3377"><em>Impact:</em></span> Great tests can protect the correctness of the program so that the original function will not be error-prone when refactoring or modifying.<br>– <span style="color:#FF3377"><em>Related Issue:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/gsoc2021-ShengFengLu/issues/1">Issue #1</a></strong><br>– <span style="color:#FF3377"><em>Related PRs:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/189">PR #189</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/182">PR #182</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#1-Detail-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine">Go to details on this page</a>.</p>
<h3 id="2-Implement-a-more-comprehensive-call-graph-Behavior-Map"><a href="#2-Implement-a-more-comprehensive-call-graph-Behavior-Map" class="headerlink" title="2. Implement a more comprehensive call graph (Behavior Map)"></a><strong>2. Implement a more comprehensive call graph (Behavior Map)</strong></h3><p>– <span style="color:#FF3377"><em>Work #1:</em></span> Behavior Map is implemented.<br>– <span style="color:#FF3377"><em>Work #2:</em></span> Rule classification report is enhanced with information such as relationships between behaviors.<br>– <span style="color:#FF3377"><em>Impact:</em></span> By reading the behavior map, users can have an overview of the relationships between suspicious behaviors in the targeted APK file.<br>– <span style="color:#FF3377"><em>Related Issue:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/issues/191">Issue #191</a></strong><br>– <span style="color:#FF3377"><em>Related PR:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/192">PR #192</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#2-Detail-Implement-a-more-comprehensive-call-graph-Behavior-Map">Go to details on this page</a>.</p>
<h3 id="3-Implement-an-abstract-class-for-Quark-core-libraries"><a href="#3-Implement-an-abstract-class-for-Quark-core-libraries" class="headerlink" title="3. Implement an abstract class for Quark core libraries"></a><strong>3. Implement an abstract class for Quark core libraries</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> Implement an <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/interface/baseapkinfo.py">abstract class</a> for Quark core libraries such as <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/apkinfo.py">apkinfo.py</a> and <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/rzapkinfo.py">rzapkinfo.py</a>.<br>– <span style="color:#FF3377"><em>Impact:</em></span> This helps to define essential methods of the Quark core library and reduces a lot of repetitive work in developing new core libraries.<br>– <span style="color:#FF3377"><em>Related PRs:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/194">PR #194</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/197">PR #197</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/203">PR #203</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#3-Detail-Implement-an-abstract-class-for-Quark-core-libraries">Go to details on this page</a>.</p>
<h3 id="4-Implement-Quark’s-new-core-library-with-Rizin"><a href="#4-Implement-Quark’s-new-core-library-with-Rizin" class="headerlink" title="4. Implement Quark’s new core library with Rizin"></a><strong>4. Implement Quark’s new core library with Rizin</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> Implement Quark’s new core library (<a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/rzapkinfo.py">rzapkinfo.py</a>) with Rizin.<br>– <span style="color:#FF3377"><em>Impact:</em></span> <a target="_blank" rel="noopener" href="https://github.com/androguard/androguard">Androguard</a> is one of the libraries used by Quark to analyze APKs, and it is rarely maintained now. Therefore, we decided to replace Androguard with Rizin. Rizin is a more active binary analysis framework that can help Quark maintain stability.<br>– <span style="color:#FF3377"><em>Related Issue:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/issues/1276">Issue #1276</a></strong><br>– <span style="color:#FF3377"><em>Related PRs:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/pull/1303">PR #1303</a>, <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/205">PR #205</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/209">PR #209</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#4-Detail-Implement-Quark%E2%80%99s-new-core-library-with-Rizin">Go to details on this page</a>.</p>
<h3 id="5-Implement-more-bytecode-instructions-in-Quark’s-Dalvik-bytecode-loader"><a href="#5-Implement-more-bytecode-instructions-in-Quark’s-Dalvik-bytecode-loader" class="headerlink" title="5. Implement more bytecode instructions in Quark’s Dalvik bytecode loader"></a><strong>5. Implement more bytecode instructions in Quark’s Dalvik bytecode loader</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> <strong>227</strong> bytecode instructions are newly implemented! Only <strong>19</strong> bytecode instructions were implemented before this project.<br>– <span style="color:#FF3377"><em>Impact:</em></span> More behaviors are detected since we implemented almost all bytecode instructions.<br>– <span style="color:#FF3377"><em>Related Issue:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/issues/131">Issue #131</a></strong><br>– <span style="color:#FF3377"><em>Related PR:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/207">PR #207</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#5-Detail-Implement-more-bytecode-instructions-in-Quark%E2%80%99s-Dalvik-bytecode-loader">Go to details on this page</a>.</p>
<h3 id="6-Add-feature-Inheritance-class-check"><a href="#6-Add-feature-Inheritance-class-check" class="headerlink" title="6. Add feature: Inheritance class check"></a><strong>6. Add feature: Inheritance class check</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> We implement a feature that checks whether a class is inherited from another class.<br>– <span style="color:#FF3377"><em>Impact:</em></span> With this feature, Quark can detect inheritance methods usage.<br>– <span style="color:#FF3377"><em>Related PR:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/210">PR #210</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#6-Detail-Add-feature-Inheritance-class-check">Go to details on this page</a>.</p>
<h3 id="7-Add-feature-API-parameters-check"><a href="#7-Add-feature-API-parameters-check" class="headerlink" title="7. Add feature: API parameters check"></a><strong>7. Add feature: API parameters check</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> We have implemented a feature that can support detecting the parameters of the Android API.<br>– <span style="color:#FF3377"><em>Impact:</em></span> With this feature implemented, Quark can now figure out if resources like SMS, call logs, or any other sensitive information is targeted.<br>– <span style="color:#FF3377"><em>Related PR:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/212">PR #212</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#7-Detail-Add-feature-API-parameters-check">Go to details on this page</a>.</p>
<h3 id="8-Quark-Performance-Improvement"><a href="#8-Quark-Performance-Improvement" class="headerlink" title="8. Quark Performance Improvement"></a><strong>8. Quark Performance Improvement</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> Tools like <a target="_blank" rel="noopener" href="https://www.brendangregg.com/flamegraphs.html">Flame Graph</a>, <a target="_blank" rel="noopener" href="https://github.com/P403n1x87/austin">Austin</a>, <a target="_blank" rel="noopener" href="https://github.com/sumerc/yappi">Yappi</a>, and <a target="_blank" rel="noopener" href="https://github.com/zhuyifei1999/guppy3">Guppy3</a> were used to evaluate to performance of Quark. Two performance bottlenecks were found.<br>– <span style="color:#FF3377"><em>Impact:</em></span> With these two bottlenecks resolved, Rizin Core Library: CPU time saves up to <strong>59.20%</strong> on average, memory usage saves up to <strong>22.27%</strong> on average. Androguard Core Library: CPU time saved up to <strong>23.95%</strong> on average.<br>– <span style="color:#FF3377"><em>Related PRs:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">PR #231</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/232">PR #232</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#8-Detail-Quark-Performance-Improvement">Go to details on this page</a>.</p>
<h3 id="9-Implement-parallelized-analysis"><a href="#9-Implement-parallelized-analysis" class="headerlink" title="9. Implement parallelized analysis"></a><strong>9. Implement parallelized analysis</strong></h3><p>– <span style="color:#FF3377"><em>Work:</em></span> We implemented parallelized techniques for Quark analysis.<br>– <span style="color:#FF3377"><em>Impact:</em></span> With this technique, the analysis performed on large APK is improved. The improvement is suitable to apply when users encounter speed issues on Quark.<br>– <span style="color:#FF3377"><em>Related PRs:</em></span> <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">PR #231</a></strong>, <strong><a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/232">PR #232</a></strong><br>– <span style="color:#FF3377"><em>Details:</em></span> <a href="#9-Detail-Implement-parallelized-analysis">Go to details on this page</a>.</p>
<hr>
<h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><h3 id="1-Detail-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine"><a href="#1-Detail-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine" class="headerlink" title="1. [Detail] Add new test cases and improve the existing ones for Quark-Engine"></a>1. [Detail] Add new test cases and improve the existing ones for Quark-Engine</h3><p>To improve existing test cases and develop a new Rizin-based core library in a test-driven development. I added several test cases based on two guidelines <strong>1. Boundary value analysis</strong> and <strong>2. Equivalence class partitioning</strong> to improve efficiency and have more comprehensive test cases.</p>
<p>A total of <strong>96</strong> test cases have been added and <strong>19</strong> existing test cases have been improved. Quark’s overall test coverage is now <strong>79%</strong> (an increase of <strong>10%</strong>).</p>
<p><span style="color:#157040"><em><strong>Relative Issue:</strong></em></span></p>
<p>Gsoc2021-ShengFengLu <a target="_blank" rel="noopener" href="https://github.com/quark-engine/gsoc2021-ShengFengLu/issues/1">Issue #1</a>: Enrich Quark tests</p>
<p><span style="color:#157040"><em><strong>Relative PRs:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/189">PR #189</a>: Refactor/enrich the rest of Quark’s tests<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/182">PR #182</a>: Refactor/enrich the tests of the analysis part of modules</p>
<p><a href="#1-Add-new-test-cases-and-improve-the-existing-ones-for-Quark-Engine">Go back to summary</a></p>
<hr>
<h3 id="2-Detail-Implement-a-more-comprehensive-call-graph-Behavior-Map"><a href="#2-Detail-Implement-a-more-comprehensive-call-graph-Behavior-Map" class="headerlink" title="2. [Detail] Implement a more comprehensive call graph (Behavior Map)"></a>2. [Detail] Implement a more comprehensive call graph (Behavior Map)</h3><p>We are committed to providing users with more insightful information. Therefore, by developing a behavior map, users can have an overview of the relationship between suspicious behaviors of different functions in the target APK. Also, these relationships could be found in the rule classification report. Please see figure 2.1. and figure 2.2. for more details.</p>
<p><img src="https://i.imgur.com/r9EwLun.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 2.1. Behavior Map</center><br>

<p><img src="https://i.imgur.com/rClsdbS.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 2.2. Rule classification report </center><br>

<p><span style="color:#157040"><em><strong>Relative Issue:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/issues/191">Issue #191</a>: Show Parent Functions’ Cross-References in Rule Classification</p>
<p><span style="color:#157040"><em><strong>Relative PR:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/192">PR #192</a>: Show Parent Functions’ Cross-References In Rule Classification</p>
<p><a href="#2-Implement-a-more-comprehensive-call-graph-Behavior-Map">Go back to summary</a></p>
<hr>
<h3 id="3-Detail-Implement-an-abstract-class-for-Quark-core-libraries"><a href="#3-Detail-Implement-an-abstract-class-for-Quark-core-libraries" class="headerlink" title="3. [Detail] Implement an abstract class for Quark core libraries"></a>3. [Detail] Implement an abstract class for Quark core libraries</h3><p>To have the Rizin based core library co-exist with the Androguard based core library and to ensure the resilience of Quark, I implemented an abstract class for Quark core libraries. Figure 3.1. is a glance at the source code of the abstract class. Please go <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/interface/baseapkinfo.py">here</a> for the complete source code.</p>
<p><img src="https://i.imgur.com/OpM0Fmc.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 3.1. Source code of The abstract class</center><br>

<p><span style="color:#157040"><em><strong>Relative PRs:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/194">PR #194</a>: Add A Standard Interface for Accessing APK Information<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/197">PR #197</a>: Clean Up the Direct Use of MethodAnalysis<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/203">PR #203</a>: Make Apkinfo implement the standard APK interface</p>
<p><a href="#3-Implement-an-abstract-class-for-Quark-core-libraries">Go back to summary</a></p>
<hr>
<h3 id="4-Detail-Implement-Quark’s-new-core-library-with-Rizin"><a href="#4-Detail-Implement-Quark’s-new-core-library-with-Rizin" class="headerlink" title="4. [Detail] Implement Quark’s new core library with Rizin"></a>4. [Detail] Implement Quark’s new core library with Rizin</h3><p>Currently, many features in Quark-Engine  rely on <a target="_blank" rel="noopener" href="https://github.com/androguard/androguard">Androguard</a> for analysis. However, Androguard remained inactive in the past two years. Therefore, to keep Quark’s resilience, we choose <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin">Rizin</a>, a more active reverse engineering framework open source project, as Quark’s new core library.</p>
<p>During development, two issues were encountered while implementing the Rizin core library. <strong>1. The result of Xref is incorrect in some cases</strong> <strong>2. It doesn’t support multiple dex file analysis.</strong></p>
<p>We reported these two issues to the Rizin community. For the <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/issues/1276">Xref issue</a>, the community proved that it is the bug of Rizin itself and they put this issue to be resolved. As for the multi-dex analysis issue, the community now has <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/pull/1303">this problem fixed</a>.</p>
<p>Here is a <a target="_blank" rel="noopener" href="https://i.imgur.com/Uc2dJPx.mp4">video</a> demonstrating a Quark analysis of the Rizin-based library.</p>
<p><span style="color:#157040"><em><strong>Relative Issue:</strong></em></span></p>
<p>Rizin <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/issues/1276">Issue #1276</a>: Missing method references in DEX</p>
<p><span style="color:#157040"><em><strong>Relative PRs:</strong></em></span></p>
<p>Rizin <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/pull/1303">PR #1303</a>: Load all dalvik files in an APK<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/205">PR #205</a>: Add a Rizin-based core library<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/209">PR #209</a>: Update travis.yml to set up Rizin</p>
<p><a href="#4-Implement-Quark%E2%80%99s-new-core-library-with-Rizin">Go back to summary</a></p>
<hr>
<h3 id="5-Detail-Implement-more-bytecode-instructions-in-Quark’s-Dalvik-bytecode-loader"><a href="#5-Detail-Implement-more-bytecode-instructions-in-Quark’s-Dalvik-bytecode-loader" class="headerlink" title="5. [Detail] Implement more bytecode instructions in Quark’s Dalvik bytecode loader"></a>5. [Detail] Implement more bytecode instructions in Quark’s Dalvik bytecode loader</h3><p>In the previous version of Quark, the Dalvik bytecode loader supported only two types of bytecodes. The lack of bytecodes may cause false positives in tainted analysis.</p>
<p>Therefore, one of my goals is to improve accuracy by adding the missing <strong>227</strong> bytecodes to the loader. All added bytecodes are related to the data flow between the registers. Now the Dalvik bytecode loader supports bytecode types such as array/exception accessing, function calls, and arithmetic operations.</p>
<p>And surprisingly, this had improved the analysis accuracy. We use <a target="_blank" rel="noopener" href="https://github.com/quark-engine/apk-malware-samples/blob/master/14d9f1a92dd984d6040cc41ed06e273e.apk">14d9f1a92dd984d6040cc41ed06e273e.apk</a> to test this implementation. Experiment results show the confidence of detected behavior increased <strong>20%</strong>. See Figure 5.1. and Figure 5.2. for more details.</p>
<p><img src="https://i.imgur.com/OVSPS1A.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 5.1. 19 bytecode instructions implemented</center><br>

<p><img src="https://i.imgur.com/PZUMOn1.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 5.2. 227 bytecode instructions implemented</center><br>

<p><span style="color:#157040"><em><strong>Relative Issue:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/issues/131">Issue #131</a>: Improve Quark’s tainted analysis accuracy in stage 5</p>
<p><span style="color:#157040"><em><strong>Relative PR:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/207">PR #207</a>: Improve the tainted analysis of Quark</p>
<p><a href="#5-Implement-more-bytecode-instructions-in-Quark%E2%80%99s-Dalvik-bytecode-loader">Go back to summary</a></p>
<hr>
<h3 id="6-Detail-Add-feature-Inheritance-class-check"><a href="#6-Detail-Add-feature-Inheritance-class-check" class="headerlink" title="6. [Detail] Add feature: Inheritance class check"></a>6. [Detail] Add feature: Inheritance class check</h3><p>Class inheritance checking is not supported by the previous versions of Quark. However, it is quite essential when detecting Android API usage.</p>
<p>Therefore, I implemented a patch to deal with this problem. Three things were implemented in this <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/210">patch</a>:</p>
<p>1. Track the data type of each register in the bytecode loader.<br>2. Construct a class inheritance relation dictionary in <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/evaluator/pyeval.py">pyeval.py</a>.<br>3. Add a lookup procedure to check the inheritance relationship to the loader.</p>
<p>And surprisingly, this had improved the analysis accuracy. We use <a target="_blank" rel="noopener" href="https://github.com/quark-engine/apk-malware-samples/blob/master/14d9f1a92dd984d6040cc41ed06e273e.apk">14d9f1a92dd984d6040cc41ed06e273e.apk</a> to test this implementation. Experiment results show the confidence of detected behavior increased <strong>20%</strong>. See Figure 6.1. and Figure 6.2. for more details.</p>
<p><img src="https://i.imgur.com/zLvKhWR.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 6.1. No inheritance class check </center><br>

<p><img src="https://i.imgur.com/jMOAImJ.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 6.2. With inheritance class check</center><br>

<p><span style="color:#157040"><em><strong>Relative PR:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/210">PR #210</a>: Enhance the Simulation Accuracy of the Bytecode Loader</p>
<p><a href="#6-Add-feature-Inheritance-class-check">Go back to summary</a></p>
<hr>
<h3 id="7-Detail-Add-feature-API-parameters-check"><a href="#7-Detail-Add-feature-API-parameters-check" class="headerlink" title="7. [Detail] Add feature: API parameters check"></a>7. [Detail] Add feature: API parameters check</h3><p>Many Android APIs represent different behaviors based on parameters. However, in the previous versions of Quark, it could not check Android API parameters, which always need manual checks when analyzing malware.</p>
<p>Therefore, by implementing this feature, Quark can now determine whether the malware gathers personal information such as SMS, call logs, or any other sensitive information.</p>
<p>This implementation lets users fill in keywords like targeted resources (SMS, Calllog) in the detection rule.</p>
<p>And surprisingly, this had improved the analysis accuracy. We use <a target="_blank" rel="noopener" href="https://github.com/quark-engine/apk-malware-samples/blob/master/14d9f1a92dd984d6040cc41ed06e273e.apk">14d9f1a92dd984d6040cc41ed06e273e.apk</a> to test this implementation. Experiment results show that the API parameters check with the new rule. See Figure 7.1. and Figure 7.2. for more details.</p>
<p><img src="https://i.imgur.com/a4kkmph.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 7.1. New detection rule</center><br>

<p><img src="https://i.imgur.com/o7XgtTg.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 7.2. Summary report With API parameters check</center><br>

<p><span style="color:#157040"><em><strong>Relative PR:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/212">PR #212</a>: Add an Optional Parameter Filter For JSON Rules</p>
<p><a href="#7-Add-feature-API-parameters-check">Go back to summary</a></p>
<hr>
<h3 id="8-Detail-Quark-Performance-Improvement"><a href="#8-Detail-Quark-Performance-Improvement" class="headerlink" title="8. [Detail] Quark Performance Improvement"></a>8. [Detail] Quark Performance Improvement</h3><p>According to user feedback, Quark encounters performance problems when analyzing large-size APKs. Therefore, we choose several performance evaluation tools such as Flame Graph, Austin, Yappi, and Guppy3 to find performance problems and solve them.</p>
<p>Our evaluation is quite simple, we take <strong>CPU time</strong> and <strong>memory usage</strong> as the indicators to evaluate the performance of Quark’s <strong>two core libraries</strong> (apkinfo.py, rzapkinfo.py). <strong>3</strong> sample APKs were chosen based on different file sizes to conduct the evaluation.</p>
<p><span style="color:#157040"><em><strong>8.1. Core Library based on Androguard</strong></em></span></p>
<p><strong>CPU time - Androguard based core library</strong></p>
<p>In this section, we use 3 sample APKs sizes ranged from 1MB, 4MB, and 10MB to evaluate the CPU time of the Androguard based core library. All 3 APKs are from the database of the University of Luxembourg, <a target="_blank" rel="noopener" href="https://androzoo.uni.lu/">AndroZoo</a>, and flagged as malware by <a target="_blank" rel="noopener" href="https://www.virustotal.com/">VirusTotal</a>. We use Flame Graph to generate 3 figures below. All figures point to one problem, that is, ==find_method()== in <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/apkinfo.py">apkinfo.py</a> occupied most of the CPU times. See Figure 8.1., Figure 8.2. and Figure 8.3. for more details.</p>
<p><img src="https://i.imgur.com/Ju4v6nK.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.1. CPU Time: APK size 1 MB</center><br>

<p><img src="https://i.imgur.com/NUhyFZG.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.2. CPU Time: APK size 5.3 MB</center><br>

<p><img src="https://i.imgur.com/dWafXc0.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.3. CPU Time: APK size 10 MB</center><br>

<p><strong>Memory Usage - Androguard based core library</strong></p>
<p>In this section, the same sample APKs were used to evaluate the memory usage of the Androguard based core library. We use Flame Graph to generate 3 figures below. All figures point to one problem: most of the memory was consumed when parsing APKs with Androguard. See Figure 8.4., Figure 8.5. and Figure 8.6. for more details.</p>
<p><img src="https://i.imgur.com/1mfQB5d.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.4. Memory Usage: APK size 1 MB</center><br>

<p><img src="https://i.imgur.com/hDAycJC.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.5. Memory Usage: APK size 5.3 MB</center><br>

<p><img src="https://i.imgur.com/Iq7Ldp9.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.6. Memory Usage: APK size 10 MB</center><br>

<p><span style="color:#157040"><em><strong>8.2. Core Library based on Rizin</strong></em></span></p>
<p><strong>CPU time - Rizin based core library</strong></p>
<p>In this section, the same sample APKs were used to evaluate the CPU time of the Rizin based core library. We use Flame Graph to generate 3 figures below. All figures point to one problem, that is, repeated calculation of unchanging results. And we found out that 3 methods have this problem. They’re ==all_methods()==, ==permission()==, and ==class_hierarchy()== in <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/rzapkinfo.py">rzapkinfo.py</a>. See Figure 8.7., Figure 8.8. and Figure 8.9. for more details.</p>
<p><img src="https://i.imgur.com/koZyNFX.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.7. CPU Time: APK size 1 MB</center><br>

<p><img src="https://i.imgur.com/Ulpl8B6.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.8. CPU Time: APK size 5.3 MB</center><br>

<p><img src="https://i.imgur.com/g6sHi9J.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.9. CPU Time: APK size 10 MB</center><br>

<p><strong>Memory Usage - Rizin based core library</strong></p>
<p>In this section, the same 3 sample APKs were used to evaluate the memory usage of Rizin based core library. We use Flame Graph to generate 3 figures below. All figures point to one problem, that is, duplicate Rizin processes. And we found out that 1 method has this problem. It is ==permission()== in rzapkinfo.py. Note that ==permission()== is invisible in the last figures since massive objects are created in the third-party method, ==cmdj()==.</p>
<p><img src="https://i.imgur.com/K2JPkvD.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.10. Memory Usage: APK size 1 MB</center><br>

<p><img src="https://i.imgur.com/sdDH2zE.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.11. Memory Usage: APK size 5.3 MB</center><br>


<p><img src="https://i.imgur.com/0HDcd6u.png" srcset="/img/loading.gif" lazyload></p>
<center>Figure 8.12. Memory Usage: APK size 10 MB</center><br>

<p><span style="color:#157040"><em><strong>8.3. Solutions to Problems found</strong></em></span></p>
<p>Androguard based core library</p>
<ul>
<li>CPU Time: We implemented a <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/232">patch</a> to <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/apkinfo.py">apkinfo.py</a> to fix this problem.</li>
<li>Memory Usage: The solution, for now, is the Rizin core library. We arrange to help Androguard solving it in the future.</li>
</ul>
<p>Rizin based core library</p>
<ul>
<li>CPU Time: We implemented a <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">patch</a> to <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/blob/master/quark/core/rzapkinfo.py">rzapkinfo.py</a> to this problem.</li>
<li>Memory Usage: This problem is solved by the same <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">patch</a> we submitted.</li>
</ul>
<p><span style="color:#157040"><em><strong>8.4. Performance Re-assessments</strong></em></span></p>
<p><strong>Androguard based core library</strong><br>After implemented the <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/232">patch</a>, the CPU time saved up to <strong>23.95%</strong> on average.</p>
<table>
<thead>
<tr>
<th>MD5</th>
<th align="right">Size<br>(MB)</th>
<th align="right">Before The Improvement<br/> (second)</th>
<th align="right">After The Improvement<br>(second)</th>
<th align="right">Percentage increase<br>(%)</th>
</tr>
</thead>
<tbody><tr>
<td>9283c74dd8356c18bb6d94b88b8fdd9b</td>
<td align="right">1</td>
<td align="right">2.00</td>
<td align="right">1.58</td>
<td align="right">26%</td>
</tr>
<tr>
<td>8e241d9a7a7cf8bf606b15a9f43af5fd</td>
<td align="right">5.3</td>
<td align="right">3.47</td>
<td align="right">2.91</td>
<td align="right">16.13%</td>
</tr>
<tr>
<td>3edfc78ab53521942798ad551027d04f</td>
<td align="right">10</td>
<td align="right">60.53</td>
<td align="right">42.53</td>
<td align="right">29.73%</td>
</tr>
</tbody></table>
<center>Table 8.1. CPU Time on all APKs</center><br>

<p><strong>Rizin based core library</strong><br>After implemented the <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">patch</a>, the CPU time saved up to <strong>59.20%</strong> on average.</p>
<table>
<thead>
<tr>
<th>MD5</th>
<th align="right">Size<br>(MB)</th>
<th align="right">Before The Improvement<br/> (second)</th>
<th align="right">After The Improvement<br>(second)</th>
<th align="right">Percentage <br>(%)</th>
</tr>
</thead>
<tbody><tr>
<td>9283c74dd8356c18bb6d94b88b8fdd9b</td>
<td align="right">1</td>
<td align="right">5.56</td>
<td align="right">1.24</td>
<td align="right">77.70%</td>
</tr>
<tr>
<td>8e241d9a7a7cf8bf606b15a9f43af5fd</td>
<td align="right">5.3</td>
<td align="right">21.47</td>
<td align="right">12.60</td>
<td align="right">41.31%</td>
</tr>
<tr>
<td>3edfc78ab53521942798ad551027d04f</td>
<td align="right">10</td>
<td align="right">1118.00</td>
<td align="right">462.90</td>
<td align="right">58.60%</td>
</tr>
</tbody></table>
<center>Table 8.2. CPU Time on all APKs</center><br>

<p>After implemented the <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">patch</a>, the memory usage saved up to <strong>22.27%</strong> on average.<br>| MD5                            | Size<br>(MB) | Before The Improvement<br/> (MB) | After The Improvement<br>(MB) | Percentage <br>(%) |<br>| ——————————— | ———–: | ——————————-: | —————————-: | —————–: |<br>| 9283c74dd8356c18bb6d94b88b8fdd9b         |            1 |                           285.00 |                        211.76 |             25.70% |<br>|  8e241d9a7a7cf8bf606b15a9f43af5fd  |      5.3     |  278.19  |235.63| 15.30% |<br>| 3edfc78ab53521942798ad551027d04f             |           10 |                          1116.40 |                        828.11 |             25.82% |</p>
<center>Table 8.3. Memory Usage on all APKs</center><br>

<p><span style="color:#157040"><em><strong>Relative PRs:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/231">PR #231</a>: Cache commonly used attributes in the Rizin core library<br>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/232">PR #232</a>: Simplify the generator value check in the Androguard core library</p>
<p><a href="#8-Quark-Performance-Improvement">Go back to summary</a></p>
<h3 id="9-Detail-Implement-parallelized-analysis"><a href="#9-Detail-Implement-parallelized-analysis" class="headerlink" title="9. [Detail] Implement parallelized analysis"></a>9. [Detail] Implement parallelized analysis</h3><p><strong>Androguard based core library</strong></p>
<p>The improvement is significant on large APKs. However, the cost of process initialization makes it not obvious when analyzing small ones. I conclude that the improvement is suitable to apply when users encounter speed issues on Quark. See Table 9.1. for more details.</p>
<table>
<thead>
<tr>
<th>MD5</th>
<th align="right">Size<br>(MB)</th>
<th align="right">Before The Improvement<br/> (Second)</th>
<th align="right">After The Improvement<br>(Second)</th>
<th align="right">Percentage <br>(%)</th>
</tr>
</thead>
<tbody><tr>
<td>9283c74dd8356c18bb6d94b88b8fdd9b</td>
<td align="right">1</td>
<td align="right">2.90</td>
<td align="right">2.04</td>
<td align="right">29.65%</td>
</tr>
<tr>
<td>8e241d9a7a7cf8bf606b15a9f43af5fd</td>
<td align="right">5.3</td>
<td align="right">3.04</td>
<td align="right">4.10</td>
<td align="right">-34.87%</td>
</tr>
<tr>
<td>3edfc78ab53521942798ad551027d04f</td>
<td align="right">10</td>
<td align="right">69.32</td>
<td align="right">42.30</td>
<td align="right">38.98%</td>
</tr>
</tbody></table>
<center>Table 9.1. Androguard analysis time on all apks</center><br>

<p><strong>Rizin based core library</strong></p>
<p>The improvement is significant on large APKs. However, the cost of process initialization makes it not obvious when analyzing small ones. I conclude that the improvement is suitable to apply when users encounter speed issues on Quark. See Table 9.2. for more details.<br>| MD5                            | Size<br>(MB) | Before The Improvement<br/> (Second) | After The Improvement<br>(Second) | Percentage <br>(%) |<br>| ——————————— | ———–: | ——————————-: | —————————-: | —————–: |<br>| 9283c74dd8356c18bb6d94b88b8fdd9b         |            1 | 1.24      |1.70|  -37.09%    |<br>| 8e241d9a7a7cf8bf606b15a9f43af5fd|   5.3 | 21.47 |    12.60      | 41.31%  |<br>| 3edfc78ab53521942798ad551027d04f             |           10 |462.90    |    36.93  | 92.02%  |</p>
<center>Table 9.2. Rizin analysis time on all apks</center><br>

<p><span style="color:#157040"><em><strong>Relative PRs:</strong></em></span></p>
<p>Quark-Engine <a target="_blank" rel="noopener" href="https://github.com/quark-engine/quark-engine/pull/223">PR #223</a>:  Parallelize the analysis</p>
<p><a href="#9-Implement-parallelized-analysis">Go back to summary</a></p>
<hr>
<h2 id="What’s-Next"><a href="#What’s-Next" class="headerlink" title="What’s Next"></a>What’s Next</h2><ol>
<li>Keep assisting the Rizin community with the <a target="_blank" rel="noopener" href="https://github.com/rizinorg/rizin/issues/1276">Xref issue</a> in APKs.</li>
<li>Address the Androguard memory problem we found and help Androguard to solve it.</li>
<li>Continuously improve the Rizin core library to make its performance better than the Androguard core library.</li>
</ol>
<h2 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h2><p>Thank my mentors, <a target="_blank" rel="noopener" href="https://github.com/krnick">JunWei Song</a> and <a target="_blank" rel="noopener" href="https://github.com/18z">KunYu Chen</a>, for their sincere support and guidance. I have learned a lot from working in Quark-Engine in the past months of GSoC. My GSoC project is my first public project of mine. I appreciate that my mentors give me insightful advice on every aspect. Thanks to both the Honeynet Project and my mentors for this great opportunity! And thanks to Androguard and Rizin for helping me reach my goal.</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/17/GSoC-2021-YuShiangDang/">
                        <span class="hidden-mobile">GSoC-2021-YuShiangDang</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
